<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">

		<title>An Update on the new Joomla! MVC</title>

		<meta name="description" content="Presentation for JAB 2015">
		<meta name="author" content="George Wilson">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="css/reveal.min.css">
		<link rel="stylesheet" href="css/theme/joomla.css" id="theme">

		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- If the query includes 'print-pdf', use the PDF print sheet -->
		<script>
			document.write( '<link rel="stylesheet" href="css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>
		<div class="reveal">
			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<h1>The new MVC for Joomla!</h1>
					<h3>Investigating the new MVC produced as part of Google Summer of Code (GSOC) 2014</h3>
					<p>
						<small>By <a href="http://www.joomjunk.co.uk" target="_blank">George Wilson</a> / <a href="http://twitter.com/GW1992">@GW1992</a></small>
					</p>
				</section>

                <section>
                    <h2>Who am I?</h2>
                    <div style="float:left;width:25%;">
                        <img src="images/george.jpg" alt="George Wilson" />
                    </div>
                    <div style="float:right;width:75%;">
                        <ul>
                            <li>Website Enthusiast
                            <ul>
                                <li>Developing extensions for Joomla! for the last 5 years</li>
                                <li>Contributing to the Joomla Docs for the last 3 years</li>
                                <li>Contributing to core for the last 2.5 years</li>
                            </ul></li>
							<li>Senior Developer for Virya Group</li>
                            <li><span style="font-weight: bold;">Ex</span> Student - Specialising in drinking, with a minor in physics</li>
                        </ul>
                    </div>
                </section>

                <section>
					 <section>
                        <h2>Aim 1: Remove JObject</h2>
                        <ul>
                            <li>PHP4 leftover<ul>
								<li>From a time where public and private variables didn't exist!<ul>
									<li>We can just use class variables directly</li>
									<li>For data sets (e.g. JTable or a "item") we can use JRegistry which has more features and is more "PHP5 friendly"</li>
								</ul></li>
								<li>Also deals with JErrors - but PHP5 introduced Exceptions to replace these!</li>
							</ul></li>
                        </ul>
                    </section>

                    <section>
                        <h2>Aim 2: Hierarchical model–view–controller (HMVC)</h2>
                        <ul>
                            <li>Many of you are familiar with MVC - however it breaks the DRY principle!!</li>
                            <li>The principle of HMVC is that you can call the code from anywhere. Imagine calling your backend model in your frontend</li>
                            <li>... or in a module?</li>
							<li>... or in a web services layer?</li>
                            <li>This is actually already done in the RAD layer (Akeeba's FOF2)</li>
                        </ul>
                        <pre><code data-trim contenteditable style="width:1100px;margin-left:-100px;">FOFDispatcher::getTmpInstance('com_foobar', 'items', array('input' => $input))->dispatch();</code></pre>
                    </section>

					<section>
                        <h2>Aim 3: Be Consistent with the base Joomla! Framework/Platform Classes</h2>
                        <ul>
                            <li>Single Task controllers</li>
							<li>Supporting more than 'just' PHP native views (e.g. Twig, Mustache etc.)</li>
                            <li>Very basic implementation - much to expand on!</li>
                        </ul>
                    </section>

					<section>
                        <h2>Aim 4: Flexability</h2>
                        <ul>
                            <li>The only thing I will bet on is that PHP in two years time will be vastly different to PHP now!</li>
							<li>The code needs to be as flexible as possible to accommodate any future changes<ul>
								<li>Use Interfaces - Common functions makes it easier for developers!</li>
								<li>Dependency Injection</li>
								<li>Look at what other people are doing!</li>
							</ul></li>
                        </ul>
                    </section>
                </section>

				<section>
					<section>
                        <h2>The Platform/Framework MVC Classes</h2>
                        <ul>
                            <li>Introduced to the Platform in 2011</li>
							<li>Introduced to the CMS in 3.0</li>
							<li>First used in the CMS in 3.3 in a com_config refactor</li>
							<li>Largely unchanged in it's framework counterpart (2013)</li>
							<li>Controller and Model packages successfully tried and tested in the JIssues tracker<ul>
								<li>View Package unused due to use of Twig in views</li>
							</ul></li>
                        </ul>
                    </section>
					<section>
                        <h2>The Platform/Framework MVC Classes: What Changed?</h2>
                        <ul>
							<li>Controller, Model and Views all now have interfaces for easier plug and play</li>
							<li>Dependency Injection (e.g. JApplication and JInput into JController)</li>
                            <li>Multitask->Single Task Controllers (more on this later)</li>
							<li>The model state is a JRegistry rather than a JObject</li>
							<li>Views now have an explicit HTML class</li>
						</ul>
                    </section>
				</section>

				<section>
					<section>
						<h2>Controllers</h2>
						<ul>
							<li>No longer extend JObject</li>
							<li>All single task controllers extend a base controller<ul>
								<li>Single task controllers however give too many files in larger extension to work effectively.</li>
								<li>Likely to revert back to multi-task controllers with an alternative CMS interface.</li>
							</ul></li>
							<li>Injection of JApplicationCms, JInput and JDocument</li>
						</ul>
					</section>
				</section>

				<section>
					<section>
						<h2>Models</h2>
						<ul>
							<li>No longer extend JObject</li>
							<li>Nested Model Structure to improve reuse of code</li>
							<li>The state is now a JRegistry instance (rather than JObject)</li>
							<li>JModel::getItem() now returns a stdClass rather than a JObject</li>
						</ul>
					</section>
				</section>

				<section>
					<section>
						<h2>Views</h2>
						<ul>
							<li>No longer extend JObject</li>
							<li>Uses the renderer interface found from the JIssues tracker<ul>
								<li>Initially under Michael's repo - as part of the v2.0 of the framework effort is now a Joomla repo</li>
								<li>Default renderer for the CMS is going to be JLayouts</li>
							</ul></li>
							<li>Removed magic get/set methods - data should be retrieved from the injected models<ul>
								<li>Can be achieved now in your components - be proactive and give it a try!</li>
							</ul></li>
						</ul>
					</section>
					<section>
						<h2>Views: Supporting old views</h2>
						<ul>
							<li>A still to be determined "legacy" class allowing your current component views to work</li>
							<li>Currently extends JViewLegacy to support some awful JLayout code<ul>
								<li>Will probably stop this by writing a new JLayout doing the same job</li>
							</ul></li>
						</ul>
					</section>
				</section>

				<section>
					<section>
						<h2>Dealing with Injecting Data - DI</h2>
						<p>One of the most obvious things missing from Joomla Core which is now widely accepted in the PHP community is Dependency Injection (DI)</p>
						<img src="images/using-di.png" alt="George Wilson" />
					</section>
					<section>
						<h2>Dealing with a DIC in Joomla Core</h2>
						<p>The issue with DIC's for Joomla is that things cannot be implemented in half measures - the current database, </p>
					</section>
                </section>

				<section>
					<section>
						<h2>Dealing with Responses</h2>
						<ul>
							<li>One of the issues with web services in Joomla is how our controllers perform redirects</li>
							<li>Many non-Joomla frameworks use Response objects to process data</li>
						</ul>
					</section>
					<section>
						<h2>Symfony's Response Object</h2>
						<img src="images/symfony-response.png" alt="George Wilson" />
					</section>
					<section>
						<h2>Symfony use in a controller</h2>
						<pre><code data-trim contenteditable style="width:1100px;margin-left:-100px;">class HelloController
{
    public function indexAction($name)
    {
        return new Response('<html><body>Hello '.$name.'!</body></html>');
    }
}</code></pre>
<p>In this scenario the controller is registered as a service provider to the global container</p>
					</section>
					<section>
						<h2>Dealing with a dispatcher</h2>
						<pre><code data-trim contenteditable style="width:1100px;margin-left:-100px;">interface DispatchableInterface
{
    /**
     * Dispatch a request
     *
     * @param   RequestInterface        $request
     * @param   null|ResponseInterface  $response
	 *
     * @return  Response|mixed
     */
    public function dispatch(RequestInterface $request, ResponseInterface $response = null);
}</code></pre>
					</section>
					<section>
						<h2>Using a Response Object in Joomla!</h2>
						<h3 class="fragment">Pros</h3>
						<ul class="fragment">
							<li>Redirects handled at a later stage in the application cycle</li>
							<li>We can alter the response (Web applications probably don't want to do the hardcoded redirects!)</li>
							<li>Easier unit testing</li>
						</ul>
						<h3 class="fragment">Con</h3>
						<ul class="fragment">
							<li>More work for extension developers to implement</li>
							<li>Higher entry point for developers</li>
						</ul>
					</section>
					<section>
						<h2>How to return a response object back to the application for processing?</h2>
						<p>Currently in JComponentHelper (the class that dispatches components) we only retrieve the contents of the rendered data in the output buffer.</p>
						<p class="fragment">An alternative: We can search for a component dispatcher and if one exists we can take advantage of this interface</p>
						<p class="fragment">We can fall back to using the current output buffer method if we can't find the dispatcher to keep b/c with the current component system</p>
					</section>
                </section>

				<section>
					<section>
						<h2>So what can you do with Legacy MVC to prepare yourself</h2>
						<ul>
							<li>Inject the state into your models from the controller via $config['state'] and $config['ignore_request']</li>
							<li>Stop using get() in your views. e.g. Instead of $this->get('Items') use $this->getModel()->getItems()</li>
							<li>Clean up your views. Make sure any getting of data from models belongs in view.html.php. Not in default.php!<ul>
								<li>Makes transitions to JLayouts as easy as changing $this to $displayData</li>
							</ul></li>
						</ul>
					</section>
					<section>
						<h2>So what can you do with Legacy MVC to prepare yourself</h2>
						<ul>
							<li>Reduce dependencies on JObject<ul>
								<li>Try to avoid using getProperties() and setProperties where possible</li>
								<li>JRegistry get() and set() are still perfectly acceptable for more complex data storage!</li>
							</ul></li>
							<li>Try using exceptions <b>where possible</b> rather than using JError</li>
						</ul>
					</section>
				</section>

				<section>
					<h2>Where am I going?</h2>
					<ol>
						<li>Sort out the issues with JViewLegacy with JLayouts</li>
						<li>Kill the populate state function and force people to initialise the state in the controller (note however if we build the object with DI we can't do this in the constructor)</li>
						<li>Controllers that call a controller!!<ul>
							<li>Save and Close controller should actually be just calling the save controller called followed by calling the close controller!</li>
						</ul></li>
						<li>Any use of JText::_('FOO') in the controller should be moved into the factory class</li>
						<li>Unit tests</li>
					</ol>
				</section>

                <section>
                    <h2>Time to wake up and interact now!</h2>
                    <p>Feel free to ask any questions you want</p>
                    <p>I hope I've given plenty of reason's to say #jpositiv</p>
					<p style="margin-top: 10%">
						<small>By <a href="http://www.gwilson.org" target="_blank">George Wilson</a> / <a href="http://twitter.com/GW1992">@GW1992</a></small>
					</p>
                </section>
			</div>
		</div>
		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.min.js"></script>

		<script>

			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
				transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
					{ src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
				]
			});

		</script>
	</body>
</html>
